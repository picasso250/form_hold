(function($){if(JSON===undefined||window.localStorage===undefined)return;var getName=function(form){return form.prop('name')||form.prop('id')||form.find('form').prop('name')||'unique'};var getLocalPath=function(name){return['form_hold',location.pathname,name].join('.')};var getData=function(form){var data={radios:{},checkboxes:{},others:{}};form.find('input,textarea,select').each(function(){var name=$(this).prop('name');switch($(this).prop('type')){case'radio':if($(this).is(':checked'))data.radios[name]=$(this).val();break;case'checkbox':data.checkboxes[name]=$(this).prop('checked');break;case'email':case'text':data.others[name]=$(this).val();break}});return data};var saveToLocal=function(data,path){var pathArr=path.split('.');var allData=window.localStorage[pathArr[0]]||null;allData=JSON.parse(allData)||{};var pageData=allData[pathArr[1]]||{};pageData[pathArr[2]]=data;allData[pathArr[1]]=pageData;window.localStorage[pathArr[0]]=JSON.stringify(allData)};var readLocal=function(path){var pathArr=path.split('.');var allData=JSON.parse(window.localStorage[pathArr[0]])||{};var pageData=allData[pathArr[1]]||{};return pageData[pathArr[2]]||{}};var fillForm=function(form,data){var others=data.others||{};for(i in others){form.find('input[name='+i+']:not([disabled])').val(others[i]).change();form.find('textarea[name='+i+']:not([disabled])').val(others[i]).change()}var checkboxs=data.checkboxs||{};for(i in checkboxs){var c=form.find('input[type=checkbox][name='+i+']:not([disabled])');if(checkboxs[i]^c.prop('checked')){c.click()}}var radios=data.radios||{};for(i in radios){form.find('input[name='+i+'][type=radio][value='+radios[i]+']:not([disabled])').click()}};$.fn.saveAs=function(name){var form=$(this);name=name||getName(form);var data=getData(form);saveToLocal(data,getLocalPath(name));return form};$.fn.restoreFrom=function(name){return $(this).each(function(){var form=$(this);name=getName(form);var data=readLocal(getLocalPath(name));fillForm(form,data)})};$(function(){$('body').find('form').restoreFrom();$('input,textarea,select').bind('click change keyup',function(){$(this).parents('form').saveAs()})})})(jQuery);
